# Iptables esame 22/02/2024

## Catena INPUT (eth0)

### impostare la politica di default per non consentire traffico in ingresso:
`iptables -P INPUT DROP`

### accettare tutti i pacchetti provenienti dalla sottorete 172.16.0.0/16:
`iptables -A INPUT -s 172.16.0.0/16 -j ACCEPT`

### scartare tutti i pacetti UDP che non sono destinati alla porta 53 (DNS):
`iptables -A INPUT -p udp ! --dport 53 -j DROP`

### accettare tutti i pacchetti relativi alle connessioni gia' stabilite;
`iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT`

## Catena OUTPUT (eth1)

### impostare la politica di default su ACCEPT:
`iptables -P OUTPUT ACCEPT`

### bloccare tutto il traffico in uscita verso la sottorete 10.0.0.0/8 eccetto il traffico HTTP e HTTPS
`iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT`
`iptables -A OUTPUT -p tcp --dport 443 -j ACCEPT`
`iptables -A OUTPUT -d 10.0.0.0/8 -j DROP`

oppure

`sudo iptables -A OUTPUT -d 10.0.0.0/8 -p tcp ! --dport 80 -j DROP`
`sudo iptables -A OUTPUT -d 10.0.0.0/8 -p tcp ! --dport 443 -j DROP`

### consentire il traffico in uscita per il servizio di DNS:
`iptables -A OUTPUT -p udp --dport 53 -j ACCEPT`

## Catena FORWARD

### impostare la politica di defalut su DROP:
`iptables -P FORWARD DROP`

### consentire il forwarding dei pacchetti tra le due interfacce solo se destnati alla porta TCP 80 o 443
`iptables -A FORWARD -i eth0 -o eth1 -p tcp --dport 80 -j ACCEPT`
`iptables -A FORWARD -i eth0 -o eth1 -p tcp --dport 443 -j ACCEPT`